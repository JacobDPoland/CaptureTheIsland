@{
    ViewData["Title"] = "Python 2 — Compiled Python Reverse Engineering";
}

<div class="container mt-4">

    <h2 class="mb-3">🐍 Medium — Python 2 (Reverse Engineering)</h2>

    <p>
        We have created a compiled Python script for you to analyze. Your job is to reverse its logic
        and determine an input that will authenticate successfully.
    </p>

    <a class="btn btn-info mb-3" href="~/files/PYTHON2.pyc" download>
        ⬇ Download PYTHON2.pyc
    </a>

    <hr />

    <h4>Submit Answer</h4>

    <form asp-action="SubmitPython2" method="post">
        <div class="mb-3">
            <label class="form-label">Enter a password that passes validation:</label>
            <input name="answer" class="form-control" placeholder="Enter solution…" />
        </div>
        <button class="btn btn-primary">Submit Answer</button>
    </form>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success mt-3">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger mt-3">@TempData["Error"]</div>
    }

    @if (TempData["Success"] != null)
    {
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                markChallengeComplete("PythonMedium");
            });
        </script>
    }

    <hr />

    <!-- Walkthrough Accordion -->
    <div class="accordion mt-4" id="python2Walkthrough">

        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne">
                    ❓ Need a hint?
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#python2Walkthrough">
                <div class="accordion-body">
                    This program is a compiled Python file. You’ll need to reverse-engineer it using
                    <strong>uncompyle</strong> or a similar tool.
                </div>
            </div>
        </div>

        <div class="accordion-item mt-2">
            <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseTwo">
                    📘 Stuck? View Full Walk-Through
                </button>
            </h2>
            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#python2Walkthrough">
                <div class="accordion-body">

                    <h5>Walk-Through</h5>

                    <p>
                        This challenge involves analyzing vulnerabilities in a compiled Python program.
                        The <strong>uncompyle</strong> program can be used to convert the compiled
                        program back into Python code.
                        The result of running uncompyle is:
                    </p>

<pre>
import sys

def main():
    if len(sys.argv) != 2:
        print 'Invalid args'
        return
    password = sys.argv[1]
    counter = 0
    vals = list('tfzbwlyzljylawhzzdvyk')
    if len(password) != len(vals):
        print 'incorrect'
        return
    while counter &lt; len(password):
        x = ord(password[counter]) + 7
        if x &gt; ord('z'):
            x -= 26
        if chr(x) != vals[counter]:
            print 'incorrect'
            return
        counter += 1

    print 'correct'

if __name__ == '__main__':
    main()
</pre>

                    <p>
                        The password validation shifts each character by +7 in the alphabet
                        (with wraparound).
                        To solve this, simply shift each character in <code>vals</code> backwards 7.
                    </p>

                    <p><strong>Correct Solution:</strong> <code>mysupersecretpassword</code></p>

                </div>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-between mt-4">
        <a href="/Challenges/PythonEasy" class="btn btn-outline-info">← Back to Easy</a>
        <a href="/Challenges/PythonHard" class="btn btn-outline-info">Next Challenge →</a>
    </div>


</div>
